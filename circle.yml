machine:
  services:
    - docker
  environment:
    AWS_DEFAULT_REGION: us-west-2
dependencies:
  cache_directories:
    - "~/docker"
  override:
    # clear go cache
    - rm -rf ~/.go_workspace/*
    - bin/circle-dependencies.sh
test:
  override:
    - bin/circle-test.sh
  post:
    # Wait for Sauce Connect to close the tunnel
    # - killall --wait sc
deployment:
  prod:
    branch: master
    commands:
      - bin/circle-deployment.sh

machine:
  node:
    version: 6.1.0
  services:
    - docker
  environment:
    AWS_DEFAULT_REGION: us-west-2
dependencies:
  cache_directories:
    - "~/.cache/yarn"
  override:
    # clear go cache so that migrate and glide get installed without
    # complaining.
    # - rm -rf ~/.go_workspace/*
    - bin/circle-dependencies.sh
compile:
  override:
    - bin/circle-compile.sh
test:
  override:
    - bin/circle-test.sh
  post:
    # Wait for Sauce Connect to close the tunnel
    # - killall --wait sc
deployment:
  prod:
    branch: master
    commands:
      - bin/circle-deployment.sh
